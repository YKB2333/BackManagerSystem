<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>商品列表</title>
    <link rel="stylesheet" href="../assets/layui/css/layui.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/common.css">
    <script src="../lib/jquery-1.10.1.min.js"></script>
    <script src="../assets/layui/layui.js"></script>
    <script src="../js/common.js"></script>
</head>
<body>
    <div id="ManagerSystem">
        <div class="left_menu">
          <dl>
            <dt>商品管理</dt>
            <dd>
                <em><a href="../html/goodslist.html">商品列表</a></em>
                <em><a href="../html/category.html">商品分类</a></em>
                <em><a href="../html/addGoods.html">添加商品</a></em>
            </dd>
        </dl>
        <dl>
            <dt>用户管理</dt>
            <dd>
                <em><a href="../html/user_list.html">用户列表</a></em>
                <em><a href="../html/user_add.html">添加用户</a></em>
            </dd>
        </dl>
        <dl>
            <dt>订单管理</dt>
            <dd>
                <em><a href="../html/order_list.html">订单列表</a></em>
            </dd>
        </dl>
        </div>
        <div class="main">
            <div class="top_path">
                <a href="">首页</a>
                <!-- /
                <a href="">商品管理</a>
                /
                <a href="">商品分类</a> -->
            </div>
            <div id="content" class="main_bottom">
                <div class="box">
                    <img src="../img/center/u70.png" class="u70_img1 u70" alt="">
                    <img src="../img/center/u70.png" class="u70_img2 u70" alt="">
                    <img src="../img/center/u70.png" class="u70_img3 u70" alt="">
                    <img src="../img/center/u70.png" class="u70_img4 u70" alt="">
                    <div class="core"  id="core_content">
                        <!-- <table id="demo" lay-filter="test"></table> -->
                        <!-- <table class="layui-hide" id="test" lay-filter="test"></table> -->
                        <table class="layui-hide" id="demo" lay-filter="test"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</body>
<script type="text/html" id="barDemo">
    <!-- <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a> -->
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    <!-- <div class="state" id="state">上架</div> -->
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="state" class="state">上架</a>

</script>
   

<script>
    layui.config({
      version: '1551352891272' //为了更新 js 缓存，可忽略
    });
     
    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider'], function(){
      var laydate = layui.laydate //日期
      ,laypage = layui.laypage //分页
      ,layer = layui.layer //弹层
      ,table = layui.table //表格
      ,carousel = layui.carousel //轮播
      ,upload = layui.upload //上传
      ,element = layui.element //元素操作
      ,slider = layui.slider //滑块
      
      //向世界问个好
    //   layer.msg('Hello World');
      
      //监听Tab切换
      element.on('tab(demo)', function(data){
        layer.tips('切换了 '+ data.index +'：'+ this.innerHTML, this, {
          tips: 1
        });
      });
      
      //执行一个 table 实例
      table.render({
        elem: '#demo'
        ,height: 420
        ,url: '/goodslist' //数据接口
        ,title: '商品列表'
        ,page: true //开启分页
        ,toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
        ,totalRow: true //开启合计行
        ,cols: [[ //表头
        {type: 'checkbox', fixed: 'left'}
        ,{field: '_id', title: 'ID', width: 120, sort: true, fixed: 'left', align:'center'}
        ,{field: 'goods_name', title: '商品名称', width: 120, align:'center', sort: true}
        ,{field: 'category', title: '分类', width: 80, sort: true, align:'center'}
        ,{field: 'old_price', title: '原价(/元)', width: 130, sort: true, align:'center'}
        ,{field: 'now_price', title: '现价(/元)', width: 130, sort: true, align:'center'}
        ,{field: 'stock', title: '库存', width: 80, sort: true, align:'center'}
        ,{field: 'state', title: '状态', width: 80, sort: true, align:'center'}
        ,{field: 'adding_time', title: '添加时间', width: 120, sort: true, align:'center'}
        ,{fixed: 'right', width: 165, align:'center', toolbar: '#barDemo'}
        ]]
      });
      
      //监听头工具栏事件
      table.on('toolbar(test)', function(obj){
        var checkStatus = table.checkStatus(obj.config.id)
        ,data = checkStatus.data; //获取选中的数据
        switch(obj.event){
          case 'add':
            // layer.msg('添加');
            window.location.href = 'addGoods.html';
          break;
          case 'update':
            if(data.length === 0){
              layer.msg('请选择一行');
            } else if(data.length > 1){
              layer.msg('只能同时编辑一个');
            } else {
              layer.alert('编辑 [ID]：'+ checkStatus.data[0]._id);
              // window.location.href = 'editGoods.html';
            }
          break;
          case 'delete':
            if(data.length === 0){
              layer.msg('请选择一行');
            } else {
              layer.msg('删除');
            }
          break;
        };
      });
      
      //监听行工具事件
      table.on('tool(test)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
        var data = obj.data //获得当前行数据
        ,layEvent = obj.event; //获得 lay-event 对应的值
        if(layEvent === 'state'){
          layer.msg('上架');
          //发起ajax请求
          // console.log(obj.data);
          // var data3 = '';
          var data3 = '_id='+data._id+'&state='+data.state;
          // if(data.state == '上架'){
          //   data3 = '_id1='+data._id+'&state1=上架';
          //   data4 = '_id2='+data._id+'&state2=下架';
          // }else if (data.state == '下架') {
          //   data3 = '_id1='+data._id+'&state1=下架';
          //   data4 = '_id2='+data._id+'&state2=上架';
          // }
          let xhr = new XMLHttpRequest();
            
          xhr.open('post','/goodslist/state',true);
          xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');

          // let data2 = "_id=" + data._id;
          console.log(data3);
          xhr.send(data3);
        } else if(layEvent === 'del'){
          layer.confirm('真的删除行么', function(index){
            obj.del(); //删除对应行（tr）的DOM结构
            layer.close(index);
            //向服务端发送删除指令
            console.log(data._id)
            

            //发起ajax请求
            let xhr = new XMLHttpRequest();
            
            xhr.open('post','/goodslist/delete',true);
            xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');

            let data2 = "_id=" + data._id;
            console.log(data2);
            xhr.send(data2);

          });
        } else if(layEvent === 'edit'){
          layer.msg('编辑操作');
          window.location.href = 'editGoods.html';

        }
      });
      


      
      //分页
      laypage.render({
        elem: 'pageDemo' //分页容器的id
        ,count: 100 //总页数
        ,skin: '#1E9FFF' //自定义选中色值
        //,skip: true //开启跳页
        ,jump: function(obj, first){
          if(!first){
            layer.msg('第'+ obj.curr +'页', {offset: 'b'});
          }
        }
      });
      
      //上传
      upload.render({
        elem: '#uploadDemo'
        ,url: '' //上传接口
        ,done: function(res){
          console.log(res)
        }
      });
      
      slider.render({
        elem: '#sliderDemo'
        ,input: true //输入框
      });
      
      //底部信息
    //   var footerTpl = lay('#footer')[0].innerHTML;
    //   lay('#footer').html(layui.laytpl(footerTpl).render({}))
    //   .removeClass('layui-hide');
    });
</script>
<!-- <script>
    layui.use('table', function(){
    var table = layui.table;
 

    //场景一：下述方法中的键值即为基础参数项
    table.render({
        elem: '#demo', //指定原始表格元素选择器（推荐id选择器）
        height: 300,
        url: '/goodslist',
        page:true,
        // initSort:'id',
        cols:  [[ //标题栏
        {checkbox: true}
        // ,{field: 'id', title: 'ID', width: 80}
        // ,{field: 'goodsname', title: '商品名称', width: 120}
        // ,{field: 'goodsname', title: '分类', width: 120}
        // ,{field: 'old_price', title: '价格（原价）', width: 80}
        // ,{field: 'now_price', title: '价格（现价）', width: 80}
        // ,{field: 'number', title: '库存', width: 60}
        // ,{field: 'state', title: '状态', width: 80}
        // ,{field: 'Adding_time', title: '添加时间', width: 80}
        // // ,{field: 'operation', title: '操作', width: 120}
        // ,{fixed: 'operation', width:150, align:'center', toolbar: '#barDemo'}
        ,{field: 'id', title: 'ID', width:80, sort: true, fixed: 'left'}
            ,{field: 'username', title: '用户名', width:80}
            ,{field: 'sex', title: '性别', width:80, sort: true}
            ,{field: 'city', title: '城市', width:80} 
            ,{field: 'sign', title: '签名', width: 177}
            ,{field: 'experience', title: '积分', width: 80, sort: true}
            ,{field: 'score', title: '评分', width: 80, sort: true}
            ,{field: 'classify', title: '职业', width: 80}
            ,{field: 'wealth', title: '财富', width: 135, sort: true}
            // ,{fixed: 'operation', width:150, align:'center', toolbar: '#barDemo'}
        ]]
    });


        //监听工具条
    // table.on('tool(test)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
    // var data = obj.data; //获得当前行数据
    // var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
    // var tr = obj.tr; //获得当前行 tr 的DOM对象
    
    // if(layEvent === 'detail'){ //查看
    //     //do somehing
    // } else if(layEvent === 'del'){ //删除
    //     layer.confirm('真的删除行么', function(index){
    //     obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
    //     layer.close(index);
    //     //向服务端发送删除指令
    //     });
    // } else if(layEvent === 'edit'){ //编辑
    //     //do something
        
    //     //同步更新缓存对应的值
    //     obj.update({
    //     username: '123'
    //     ,title: 'xxx'
    //     });
    // }
    // });
})
</script> -->

    
</html>